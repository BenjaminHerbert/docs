# docs - User documentation for Giant Swarm

Our Documentation is based on Markdown and HTML content and generated using [HUGO](http://gohugo.io/), a static site generator written in Go.

## Component Overview

![docs_component_architecture](https://cloud.githubusercontent.com/assets/273727/7582315/9db0bbee-f88c-11e4-90ab-ec77579f50b9.png)

|Short name    | Docker image            | Source repository                                                  |
|--------------|-------------------------|--------------------------------------------------------------------|
|`docs-proxy`  | `giantswarm/docs-proxy` | [giantswarm/docs-proxy](https://github.com/giantswarm/docs-proxy/) |
|`docs`        | `giantswarm/docs`       | this repository                                                    |
|`sitesearch`  | `giantswarm/sitesearch` | [giantswarm/sitesearch](https://github.com/giantswarm/sitesearch/) |


## Where's the content?

Content is in this public repo: [giantswarm/docs-content](https://github.com/giantswarm/docs-content).

The content is served using the `docs` component. It's copied during the build process. Look at the `Makefile` for details.

## Development setup

You have several options for bringing up the docs locally, depending on your needs.

1. Running only the `docs` Docker container (in short: `make build && make run`)
2. Running all components at once (in short: `docker-compose up`)
3. Running Hugo on your local system (in short: `./run-dev.sh`)

If all you want is write and preview content, skip to option 3.

### Building the `docs` Docker image

Both option 1 and 2 require you to be able to build a current `docs` image. To initiate this, execute `make build`.

The `make build` will clone the [giantswarm/docs-content](https://github.com/giantswarm/docs-content) repository and copy it's content to the correct locations. After that, the `docker build` process is executed.

Caution: Treat the clone of `docs-content` that has been generated by `make-build` as read-only. It will be thrown away on every new build.

### Option 1: Running only the `docs` Docker container

After building the Docker image, simply run it by executing `make run`. Then access `http://192.168.59.103/`.

Note that this setup is tailored towards use with the boot2docker defaults. If your Docker host IP is different, please modify the IP address in the `Makefile` (target `run`) according to your needs and access that IP accordingly.

### Option 2: Running all components at once

The full documentation application consists of several components. The best way to run them all locally is using `docker-compose`. To start the application locally, including proxy and search functions, use

```
docker-compose up
```

Look at the `docker-compose.yml` file for details on what happens here.

Caveat: Make sure to remove previously generated containers from the `docs` image before restarting the application locally. Otherwise changes are not picked up. `docker-compose rm docsmaster` and `docker-compose rm docsslave` are your friend.

### Option 3: Running Hugo on your local system

For a quick preview, with `hugo` installed (`brew install hugo`), run `./run-dev.sh` and access `http://localhost:1313/`.

Make sure to run the same hugo version locally as on the server. The currently used version is v0.13.1.

Hint: When using this method, you can control manually how content changes are tied into the directory structure. Look at the Makefile to get an idea what belongs where. A good way to make changes visible directly during a longer editing session is creating symlinks:

```
ln -s ../path/to/docs-content/content swarmdocs/content
ln -s ../path/to/docs-content/img swarmdocs/static/img
```

## Deploying the `docs` Component to the Swarm

When `make build` works fine to create the image and a test using `docker-compose up` was successful, you can release the new version.

Execute `builder`:

```
builder release <patch|minor|major>
```

This will, amongst other things, automatically do a new build and push the image to the registry.

Next, to apply the new image in the live Giant Swarm application:

1. Update the `content-master` component:

```
SWARM_CLUSTER_ID=cluster-01.private.giantswarm.io swarm update docs/content-master/content
```

This will update the search index and replace the first of the content servers.

2. Update the `content-slave` component:

```
SWARM_CLUSTER_ID=cluster-01.private.giantswarm.io swarm update docs/content-slave/content
```

This will replace the second of the content servers.

## About writing for the documentation

There is more information available in the [Wiki](https://git.giantswarm.io/giantswarm/docs/wikis/home).
